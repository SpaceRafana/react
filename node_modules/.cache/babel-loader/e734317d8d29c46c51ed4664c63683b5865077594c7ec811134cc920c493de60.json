{"ast":null,"code":"import _classCallCheck from \"E:/Mon Site/portfolio-react/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"E:/Mon Site/portfolio-react/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { Triangle, Vector3 } from \"three\";\nvar _face = new Triangle();\nvar _color = new Vector3();\nvar MeshSurfaceSampler = /*#__PURE__*/function () {\n  function MeshSurfaceSampler(mesh) {\n    _classCallCheck(this, MeshSurfaceSampler);\n    var geometry = mesh.geometry;\n    if (geometry.index) {\n      console.warn(\"THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry.\");\n      geometry = geometry.toNonIndexed();\n    }\n    this.geometry = geometry;\n    this.randomFunction = Math.random;\n    this.positionAttribute = this.geometry.getAttribute(\"position\");\n    this.colorAttribute = this.geometry.getAttribute(\"color\");\n    this.weightAttribute = null;\n    this.distribution = null;\n  }\n  _createClass(MeshSurfaceSampler, [{\n    key: \"setWeightAttribute\",\n    value: function setWeightAttribute(name) {\n      this.weightAttribute = name ? this.geometry.getAttribute(name) : null;\n      return this;\n    }\n  }, {\n    key: \"build\",\n    value: function build() {\n      var positionAttribute = this.positionAttribute;\n      var weightAttribute = this.weightAttribute;\n      var faceWeights = new Float32Array(positionAttribute.count / 3);\n      for (var i = 0; i < positionAttribute.count; i += 3) {\n        var faceWeight = 1;\n        if (weightAttribute) {\n          faceWeight = weightAttribute.getX(i) + weightAttribute.getX(i + 1) + weightAttribute.getX(i + 2);\n        }\n        _face.a.fromBufferAttribute(positionAttribute, i);\n        _face.b.fromBufferAttribute(positionAttribute, i + 1);\n        _face.c.fromBufferAttribute(positionAttribute, i + 2);\n        faceWeight *= _face.getArea();\n        faceWeights[i / 3] = faceWeight;\n      }\n      this.distribution = new Float32Array(positionAttribute.count / 3);\n      var cumulativeTotal = 0;\n      for (var _i = 0; _i < faceWeights.length; _i++) {\n        cumulativeTotal += faceWeights[_i];\n        this.distribution[_i] = cumulativeTotal;\n      }\n      return this;\n    }\n  }, {\n    key: \"setRandomGenerator\",\n    value: function setRandomGenerator(randomFunction) {\n      this.randomFunction = randomFunction;\n      return this;\n    }\n  }, {\n    key: \"sample\",\n    value: function sample(targetPosition, targetNormal, targetColor) {\n      var faceIndex = this.sampleFaceIndex();\n      return this.sampleFace(faceIndex, targetPosition, targetNormal, targetColor);\n    }\n  }, {\n    key: \"sampleFaceIndex\",\n    value: function sampleFaceIndex() {\n      var cumulativeTotal = this.distribution[this.distribution.length - 1];\n      return this.binarySearch(this.randomFunction() * cumulativeTotal);\n    }\n  }, {\n    key: \"binarySearch\",\n    value: function binarySearch(x) {\n      var dist = this.distribution;\n      var start = 0;\n      var end = dist.length - 1;\n      var index = -1;\n      while (start <= end) {\n        var mid = Math.ceil((start + end) / 2);\n        if (mid === 0 || dist[mid - 1] <= x && dist[mid] > x) {\n          index = mid;\n          break;\n        } else if (x < dist[mid]) {\n          end = mid - 1;\n        } else {\n          start = mid + 1;\n        }\n      }\n      return index;\n    }\n  }, {\n    key: \"sampleFace\",\n    value: function sampleFace(faceIndex, targetPosition, targetNormal, targetColor) {\n      var u = this.randomFunction();\n      var v = this.randomFunction();\n      if (u + v > 1) {\n        u = 1 - u;\n        v = 1 - v;\n      }\n      _face.a.fromBufferAttribute(this.positionAttribute, faceIndex * 3);\n      _face.b.fromBufferAttribute(this.positionAttribute, faceIndex * 3 + 1);\n      _face.c.fromBufferAttribute(this.positionAttribute, faceIndex * 3 + 2);\n      targetPosition.set(0, 0, 0).addScaledVector(_face.a, u).addScaledVector(_face.b, v).addScaledVector(_face.c, 1 - (u + v));\n      if (targetNormal !== void 0) {\n        _face.getNormal(targetNormal);\n      }\n      if (targetColor !== void 0 && this.colorAttribute !== void 0) {\n        _face.a.fromBufferAttribute(this.colorAttribute, faceIndex * 3);\n        _face.b.fromBufferAttribute(this.colorAttribute, faceIndex * 3 + 1);\n        _face.c.fromBufferAttribute(this.colorAttribute, faceIndex * 3 + 2);\n        _color.set(0, 0, 0).addScaledVector(_face.a, u).addScaledVector(_face.b, v).addScaledVector(_face.c, 1 - (u + v));\n        targetColor.r = _color.x;\n        targetColor.g = _color.y;\n        targetColor.b = _color.z;\n      }\n      return this;\n    }\n  }]);\n  return MeshSurfaceSampler;\n}();\nexport { MeshSurfaceSampler };\n//# sourceMappingURL=MeshSurfaceSampler.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}